<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Kalenteri">
    <meta name="keywords" content="kalenteri, opiskelukalenteri, teht√§v√§t, aikataulu">
    <meta name="author" content="Enoch">
    <meta name="robots" content="index, follow">

    <title>Kalenteri ‚Äì OpiskeluTools</title>

    <!-- Ulkoiset fontit Google Fontsista -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700&family=Open+Sans:wght@700&display=swap"
        rel="stylesheet">
    <!-- Oma CSS-tyylitiedosto -->
    <link rel="stylesheet" href="style.css">
    <!-- FontAwesome ikonikirjasto -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <!-- Sivun header-osio logon ja navigaation -->
    <header>
        <!-- Logo linkkin√§ etusivulle -->
        <a href="index.html">
            <img src="logo.png" alt="OpiskeluTools logo" class="logo-img">
        </a>
        <!-- Sivuston nimi n√§kyviss√§ logon vieress√§ -->
        <div class="logo">OpiskeluTools</div>
        <!-- Hampurilaisvalikko -->
        <button class="menu-toggle" aria-label="Avaa valikko">‚ò∞</button>
        <!-- Navigointilinkit muihin sivuihin -->
        <nav class="nav-links">
            <a href="muistiinpanot.html"><i class="fas fa-book"></i> Muistiinpanot</a>
            <a href="tehtavat.html"><i class="fas fa-tasks"></i> Teht√§v√§t</a>
            <a href="kalenteri.html"><i class="fas fa-calendar-alt"></i> Kalenteri</a>
            <a href="tietoa.html"><i class="fas fa-info-circle"></i> Tietoa</a>
        </nav>
    </header>

    <!-- Sivun p√§√§sis√§lt√∂ -->
    <main class="container">
        <!-- Sivun otsikko -->
        <h1>üìÖ Kalenteri</h1>

        <!-- Kuukauden navigointipainikkeet -->
        <div class="month-navigation">
            <button id="prevMonth">‚Üê Edellinen</button>
            <span id="currentMonth"></span>
            <button id="nextMonth">Seuraava ‚Üí</button>
        </div>

        <!-- Viikonp√§ivien otsikot -->
        <div id="calendarHeader" class="calendar-header">
            <div>Ma</div>
            <div>Ti</div>
            <div>Ke</div>
            <div>To</div>
            <div>Pe</div>
            <div>La</div>
            <div>Su</div>
        </div>

        <!-- Kalenterin p√§ivien ruudukko -->
        <div id="calendar" class="calendar-grid"></div>

        <div id="eventForm" class="hidden">
            <h3>üñäÔ∏è Tapahtuman muokkaus <span id="selectedDate"></span></h3>
            <input type="text" id="eventTitle" placeholder="Merkinn√§n otsikko...">
            <button id="saveEvent">üíæ Tallenna</button>
            <ul id="eventList"></ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <p>&copy; 2025 OpiskeluTools</p>
        <!-- Linkki takaisin sivun yl√§osaan -->
        <p><a href="#">üîù Takaisin yl√∂s</a></p>
    </footer>

    <script>
        // Valitaan DOM-elementit JavaScriptiss√§
        const calendar = document.getElementById("calendar");
        const selectedDateSpan = document.getElementById("selectedDate");
        const eventForm = document.getElementById("eventForm");
        const saveEvent = document.getElementById("saveEvent");
        const eventTitle = document.getElementById("eventTitle");
        const eventList = document.getElementById("eventList");
        const currentMonthLabel = document.getElementById("currentMonth");

        // Mobiilivalikon toiminnallisuus
        const toggle = document.querySelector(".menu-toggle");
        const nav = document.querySelector(".nav-links");

        toggle.addEventListener("click", (e) => {
            e.stopPropagation(); // Est√§√§ valikon sulkeutumisen heti
            nav.classList.toggle("active");
        });

        // Sulkee valikon, kun klikataan valikon tai napin ulkopuolelle
        document.addEventListener("click", (e) => {
            if (!nav.contains(e.target) && !toggle.contains(e.target)) {
                nav.classList.remove("active");

            }

            // Sulkee my√∂s tapahtumalomakkeen, jos klikataan kalenterin tai lomakkeen ulkopuolelle
            if (!calendar.contains(e.target) && !eventForm.contains(e.target)) {
                eventForm.classList.add("hidden");
                saveEvent.dataset.date = "";
            }
        });

        //Nykyinen p√§iv√§m√§√§r√§
        let current = new Date();
        let viewedYear = current.getFullYear();
        let viewedMonth = current.getMonth();
        const monthNames = ["Tammikuu", "Helmikuu", "Maaliskuu", "Huhtikuu", "Toukokuu", "Kes√§kuu", "Hein√§kuu", "Elokuu", "Syyskuu", "Lokakuu", "Marraskuu", "Joulukuu"];

        function updateEventList(dateKey) {
            // Haetaan tapahtumat localStoragesta
            const events = JSON.parse(localStorage.getItem(`event-${dateKey}`)) || [];
            eventList.innerHTML = "";

            events.forEach((ev, index) => {
                const li = document.createElement("li");
                li.textContent = ev;

                // Poistonappi
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "‚ùå";
                deleteBtn.classList.add("event-list-button");

                deleteBtn.style.marginLeft = "10px";
                deleteBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    // Poistetaan tapahtuma taulukosta ja p√§ivitet√§√§n tallennus
                    events.splice(index, 1);
                    localStorage.setItem(`event-${dateKey}`, JSON.stringify(events));
                    updateEventList(dateKey);
                    renderCalendar();
                });

                // Muokkauspainike
                const editBtn = document.createElement("button");
                editBtn.textContent = "‚úèÔ∏è";
                editBtn.classList.add("event-list-button");

                editBtn.style.marginLeft = "10px";
                editBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    eventTitle.value = ev;
                    events.splice(index, 1);
                    localStorage.setItem(`event-${dateKey}`, JSON.stringify(events));
                    updateEventList(dateKey);
                    renderCalendar();
                });

                // Lis√§t√§√§n painikkeet listaelementtiin
                li.appendChild(deleteBtn);
                li.appendChild(editBtn);
                eventList.appendChild(li);
            });
        }

        // Piirt√§√§ kalenterin valitulle kuukaudelle ja vuodelle
        function renderCalendar() {
            calendar.innerHTML = "";

            // Kuukauden ensimm√§inen ja viimeinen p√§iv√§
            const firstDay = new Date(viewedYear, viewedMonth, 1);
            const lastDay = new Date(viewedYear, viewedMonth + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7;

            // N√§ytet√§√§n kuukauden ja vuoden nimi
            currentMonthLabel.textContent = `${monthNames[viewedMonth]} ${viewedYear}`;

            for (let i = 0; i < startDay; i++) {
                const empty = document.createElement("div");
                calendar.appendChild(empty);
            }

            //P√§iv√§ruudut
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayBox = document.createElement("div");
                dayBox.className = "day-box";
                dayBox.textContent = day;

                // Korostetaan nykyinen p√§iv√§
                if (
                    viewedYear === current.getFullYear() &&
                    viewedMonth === current.getMonth() &&
                    day === current.getDate()
                ) {
                    dayBox.classList.add("today");
                }

                const dateKey = `${viewedYear}-${viewedMonth + 1}-${day}`;
                const events = JSON.parse(localStorage.getItem(`event-${dateKey}`)) || [];

                // N√§ytet√§√§n merkint√§piste, jos tapahtumia on
                if (events.length > 0) {
                    const dot = document.createElement("span");
                    dot.className = "event-dot";
                    dot.title = events.join("\n");
                    dayBox.appendChild(dot);
                }

                // Klikattaessa avataan tapahtumalomake kyseiselle p√§iv√§lle
                dayBox.addEventListener("click", () => {
                    if (eventForm.classList.contains("hidden") || saveEvent.dataset.date !== dateKey) {
                        eventForm.classList.remove("hidden");
                        selectedDateSpan.textContent = `${day}.${viewedMonth + 1}.${viewedYear}`;
                        saveEvent.dataset.date = dateKey;
                        eventTitle.value = "";
                        updateEventList(dateKey);
                    } else {
                        eventForm.classList.add("hidden");
                        saveEvent.dataset.date = "";
                    }
                });

                calendar.appendChild(dayBox);
            }
        }

        // Tallennetaan uusi tapahtuma
        saveEvent.addEventListener("click", () => {
            const dateKey = saveEvent.dataset.date;
            const value = eventTitle.value.trim();
            if (value) {
                const events = JSON.parse(localStorage.getItem(`event-${dateKey}`)) || [];
                events.push(value);
                localStorage.setItem(`event-${dateKey}`, JSON.stringify(events));
            }
            eventForm.classList.add("hidden");
            renderCalendar();
        });

        // Kuukauden vaihto taaksep√§in
        document.getElementById("prevMonth").addEventListener("click", () => {
            viewedMonth--;
            if (viewedMonth < 0) {
                viewedMonth = 11;
                viewedYear--;
            }
            renderCalendar();
        });

        // Kuukauden vaihto eteenp√§in
        document.getElementById("nextMonth").addEventListener("click", () => {
            viewedMonth++;
            if (viewedMonth > 11) {
                viewedMonth = 0;
                viewedYear++;
            }
            renderCalendar();
        });

        // Piirret√§√§n kalenteri ensimm√§isell√§ latauksella
        renderCalendar();
    </script>
</body>

</html>